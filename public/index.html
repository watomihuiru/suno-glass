<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Music Studio</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/sections.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <div class="bg-gradient"></div>

    <div class="main-container">
        <!-- SIDEBAR -->
        <nav class="glass-panel sidebar">
            <div class="logo"><i class="fa-solid fa-wave-square"></i> Suno AI</div>
            <ul class="menu">
                <li class="active" data-tab="generate"><i class="fa-solid fa-wand-magic-sparkles"></i> Generate</li>
                <li data-tab="extend"><i class="fa-solid fa-arrows-left-right-to-line"></i> Extend</li>
                <li data-tab="cover"><i class="fa-solid fa-microphone-lines"></i> Cover</li>
                <li data-tab="logs" class="logs-tab"><i class="fa-solid fa-terminal"></i> API Logs</li>
            </ul>
        </nav>

        <main class="content-area">
            <!-- GENERATE TAB -->
            <section id="generate" class="tab-content active">
                <div class="glass-panel content-card">
                    <h2>Create New Track</h2>
                    <p class="subtitle">Describe the song you want to hear</p>
                    
                    <form id="generateForm">
                        <div class="form-group">
                            <label style="margin-bottom: 12px; display:block;">Model Version</label>
                            <div class="model-selector">
                                <!-- V3.5 -->
                                <input type="radio" name="model" id="m_v3_5" value="V3_5"> 
                                <label for="m_v3_5">v3.5</label>

                                <!-- V4 -->
                                <input type="radio" name="model" id="m_v4" value="V4"> 
                                <label for="m_v4">v4</label>

                                <!-- V4.5 -->
                                <input type="radio" name="model" id="m_v4_5" value="V4_5"> 
                                <label for="m_v4_5">v4.5</label>

                                <!-- V4.5+ -->
                                <input type="radio" name="model" id="m_v4_5_plus" value="V4_5PLUS"> 
                                <label for="m_v4_5_plus">v4.5+</label>

                                <!-- V5 -->
                                <input type="radio" name="model" id="m_v5" value="V5" checked> 
                                <label for="m_v5">v5</label>

                                <div class="glider"></div>
                            </div>
                        </div>

                        <div class="settings-grid">
                            <div class="form-group">
                                <label>Instrumental</label>
                                <div class="toggle-selector">
                                    <input type="radio" name="instrumental" id="inst_off" value="false" checked>
                                    <label for="inst_off">Off</label>
                                    <input type="radio" name="instrumental" id="inst_on" value="true">
                                    <label for="inst_on">On</label>
                                    <div class="glider"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Custom Mode</label>
                                <div class="toggle-selector">
                                    <input type="radio" name="customMode" id="custom_off" value="false" checked>
                                    <label for="custom_off">Off</label>
                                    <input type="radio" name="customMode" id="custom_on" value="true">
                                    <label for="custom_on">On</label>
                                    <div class="glider"></div>
                                </div>
                            </div>
                        </div>

                        <div id="customFields" class="hidden">
                            <div class="form-group input-wrapper">
                                <label>Title</label>
                                <input type="text" id="title" placeholder="Song Title" maxlength="80">
                                <span id="titleCounter" class="char-counter">0 / 80</span>
                            </div>
                            <div class="form-group input-wrapper">
                                <label>Style (Genre)</label>
                                <input type="text" id="style" placeholder="Pop, Rock, Electronic...">
                                <span id="styleCounter" class="char-counter">0 / 200</span>
                            </div>
                        </div>

                        <div class="form-group input-wrapper" id="promptContainer">
                            <label id="promptLabel">Song Description</label>
                            <textarea id="prompt" placeholder="A futuristic synthwave track..." required></textarea>
                            <span id="promptCounter" class="char-counter">0 / 3000</span>
                        </div>

                        <div class="advanced-section">
                            <div class="advanced-toggle" id="genAdvancedToggle">
                                <span>Advanced Settings</span><i class="fa-solid fa-chevron-down"></i>
                            </div>
                            <div class="advanced-content" id="genAdvancedContent">
                                <div class="form-group gender-group" id="vocalGenderGroup" style="margin-top: 15px;">
                                    <label>Vocal Gender <i class="fa-solid fa-circle-info" title="Works best with Custom Mode"></i></label>
                                    <div class="gender-options" id="genGenderOptions">
                                        <span class="gender-option" data-value="m">Male</span>
                                        <span class="gender-option" data-value="f">Female</span>
                                    </div>
                                    <input type="hidden" id="vocalGender" value="">
                                </div>
                                <div class="form-group">
                                    <label>Negative Tags (Exclude)</label>
                                    <input type="text" id="negativeTags" placeholder="e.g. Drums, Guitar">
                                </div>
                                <div class="sliders-grid">
                                    <div class="slider-control">
                                        <label>Style Weight</label>
                                        <input type="range" id="genStyleWeight" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                    <div class="slider-control">
                                        <label>Audio Weight</label>
                                        <input type="range" id="genAudioWeight" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                    <div class="slider-control">
                                        <label>Weirdness</label>
                                        <input type="range" id="genWeirdness" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="submit-row">
                            <button type="button" id="genResetBtn" class="reset-btn"><i class="fa-solid fa-trash"></i></button>
                            <button type="submit" class="generate-btn"><i class="fa-solid fa-bolt"></i> Generate Music</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- EXTEND TAB -->
            <section id="extend" class="tab-content">
                <div class="glass-panel content-card">
                    <h2>Extend Track</h2>
                    <p class="subtitle">Extend audio while preserving the original style</p>
                    
                    <form id="extendForm">
                        <input type="hidden" id="extendAudioUrl" value="">
                        <input type="hidden" id="continueAt" value="">
                        
                        <div class="form-group">
                            <label>Source Audio (Max 2 min)</label>
                            <div class="upload-zone" id="extendUploadZone">
                                <input type="file" id="extendFileInput" accept="audio/*" hidden>
                                <div class="upload-content" id="extendUploadContent">
                                    <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                                    <p>Click to upload</p>
                                    <span class="upload-hint">Or select from Library</span>
                                </div>
                                <div class="file-preview hidden" id="extendFilePreview">
                                    <i class="fa-solid fa-music file-icon"></i>
                                    <div class="file-info">
                                        <span class="file-name" id="extendFileNameDisplay">song.mp3</span>
                                        <span class="file-size" id="extendFileSizeDisplay">File</span>
                                    </div>
                                    <button type="button" class="remove-file-btn" id="extendRemoveFileBtn"><i class="fa-solid fa-xmark"></i></button>
                                </div>
                                <div class="track-preview hidden" id="extendTrackPreview">
                                    <div class="extend-track-header">
                                        <div class="extend-cover-container">
                                            <img src="" id="extendTrackPreviewImg" class="extend-track-cover">
                                            <button type="button" class="extend-play-btn" id="extendPlayBtn" onclick="playExtendTrack()">
                                                <i class="fa-solid fa-play" id="extendPlayIcon"></i>
                                            </button>
                                        </div>
                                        <div class="extend-track-info">
                                            <span class="file-name" id="extendTrackPreviewTitle">Track Title</span>
                                            <span class="file-size">From Library</span>
                                        </div>
                                        <button type="button" class="remove-file-btn" id="extendRemoveTrackBtn"><i class="fa-solid fa-xmark"></i></button>
                                    </div>
                                    <div class="extend-waveform-container">
                                        <canvas id="extendWaveform" class="extend-waveform"></canvas>
                                        <div class="extend-selection-handle" id="extendSelectionHandle"></div>
                                        <div class="extend-selection-overlay" id="extendSelectionOverlay"></div>
                                    </div>
                                    <div class="extend-time-info">
                                        <span id="extendTimeLabel">Extend from <strong id="extendTimeValue">0:00</strong></span>
                                    </div>
                                    <audio id="extendAudioPlayer" preload="metadata"></audio>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="margin-bottom: 12px; display:block;">Model Version</label>
                            <div class="model-selector">
                                <input type="radio" name="extendModel" id="em_v3_5" value="V3_5"> 
                                <label for="em_v3_5">v3.5</label>

                                <input type="radio" name="extendModel" id="em_v4" value="V4"> 
                                <label for="em_v4">v4</label>

                                <input type="radio" name="extendModel" id="em_v4_5" value="V4_5"> 
                                <label for="em_v4_5">v4.5</label>

                                <input type="radio" name="extendModel" id="em_v4_5_plus" value="V4_5PLUS"> 
                                <label for="em_v4_5_plus">v4.5+</label>

                                <input type="radio" name="extendModel" id="em_v5" value="V5" checked> 
                                <label for="em_v5">v5</label>

                                <div class="glider"></div>
                            </div>
                        </div>

                        <div class="settings-grid">
                            <div class="form-group">
                                <label>Instrumental</label>
                                <div class="toggle-selector">
                                    <input type="radio" name="extendInstrumental" id="extend_inst_off" value="false" checked>
                                    <label for="extend_inst_off">Off</label>
                                    <input type="radio" name="extendInstrumental" id="extend_inst_on" value="true">
                                    <label for="extend_inst_on">On</label>
                                    <div class="glider"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Custom Mode</label>
                                <div class="toggle-selector">
                                    <input type="radio" name="extendCustomMode" id="extend_custom_off" value="false" checked>
                                    <label for="extend_custom_off">Off</label>
                                    <input type="radio" name="extendCustomMode" id="extend_custom_on" value="true">
                                    <label for="extend_custom_on">On</label>
                                    <div class="glider"></div>
                                </div>
                            </div>
                        </div>

                        <div id="extendCustomFields" class="hidden">
                            <div class="form-group input-wrapper">
                                <label>Title</label>
                                <input type="text" id="extendTitle" placeholder="Extended Track Title" maxlength="100">
                                <span id="extendTitleCounter" class="char-counter">0 / 100</span>
                            </div>
                            <div class="form-group input-wrapper">
                                <label>Style (Genre)</label>
                                <input type="text" id="extendStyle" placeholder="Jazz, Classical, Electronic...">
                                <span id="extendStyleCounter" class="char-counter">0 / 1000</span>
                            </div>
                        </div>

                        <div class="form-group input-wrapper" id="extendPromptContainer">
                            <label id="extendPromptLabel">Extension Description</label>
                            <textarea id="extendPrompt" placeholder="Extend the music with more relaxing notes..."></textarea>
                            <span id="extendPromptCounter" class="char-counter">0 / 5000</span>
                        </div>

                        <div class="advanced-section">
                            <div class="advanced-toggle" id="extendAdvancedToggle">
                                <span>Advanced Settings</span><i class="fa-solid fa-chevron-down"></i>
                            </div>
                            <div class="advanced-content" id="extendAdvancedContent">
                                <div class="form-group gender-group" id="extendVocalGenderGroup" style="margin-top: 15px;">
                                    <label>Vocal Gender</label>
                                    <div class="gender-options" id="extGenderOptions">
                                        <span class="gender-option" data-value="m">Male</span>
                                        <span class="gender-option" data-value="f">Female</span>
                                    </div>
                                    <input type="hidden" id="extendVocalGender" value="">
                                </div>
                                <div class="form-group">
                                    <label>Negative Tags</label>
                                    <input type="text" id="extendNegativeTags" placeholder="e.g. Drums, Guitar">
                                </div>
                                <div class="sliders-grid">
                                    <div class="slider-control">
                                        <label>Style Weight</label>
                                        <input type="range" id="extendStyleWeight" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                    <div class="slider-control">
                                        <label>Audio Weight</label>
                                        <input type="range" id="extendAudioWeight" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                    <div class="slider-control">
                                        <label>Weirdness</label>
                                        <input type="range" id="extendWeirdness" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="submit-row">
                            <button type="button" id="extendResetBtn" class="reset-btn"><i class="fa-solid fa-trash"></i></button>
                            <button type="submit" class="generate-btn"><i class="fa-solid fa-arrows-left-right-to-line"></i> Extend Music</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- COVER TAB -->
            <section id="cover" class="tab-content">
                <div class="glass-panel content-card">
                    <h2>Remix / Cover</h2>
                    <p class="subtitle">Change style while keeping melody</p>
                    
                    <form id="coverForm">
                        <input type="hidden" id="coverAudioUrl" value="">
                        
                        <div class="form-group">
                            <label>Source Audio (Max 8 min)</label>
                            <div class="upload-zone" id="uploadZone">
                                <input type="file" id="coverFileInput" accept="audio/*" hidden>
                                <div class="upload-content" id="uploadContent">
                                    <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                                    <p>Click to upload</p>
                                    <span class="upload-hint">Or select from Library</span>
                                </div>
                                <div class="file-preview hidden" id="filePreview">
                                    <i class="fa-solid fa-music file-icon"></i>
                                    <div class="file-info">
                                        <span class="file-name" id="fileNameDisplay">song.mp3</span>
                                        <span class="file-size" id="fileSizeDisplay">File</span>
                                    </div>
                                    <button type="button" class="remove-file-btn" id="removeFileBtn"><i class="fa-solid fa-xmark"></i></button>
                                </div>
                                <div class="track-preview hidden" id="trackPreview">
                                    <img src="" id="trackPreviewImg" class="track-preview-img">
                                    <div class="file-info">
                                        <span class="file-name" id="trackPreviewTitle">Track Title</span>
                                        <span class="file-size">From Library</span>
                                    </div>
                                    <button type="button" class="remove-file-btn" id="removeTrackBtn"><i class="fa-solid fa-xmark"></i></button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="margin-bottom: 12px; display:block;">Model Version</label>
                            <div class="model-selector">
                                <!-- Используем name="coverModel" чтобы не путать с первой формой -->
                                <input type="radio" name="coverModel" id="cm_v3_5" value="V3_5"> 
                                <label for="cm_v3_5">v3.5</label>

                                <input type="radio" name="coverModel" id="cm_v4" value="V4"> 
                                <label for="cm_v4">v4</label>

                                <input type="radio" name="coverModel" id="cm_v4_5" value="V4_5"> 
                                <label for="cm_v4_5">v4.5</label>

                                <input type="radio" name="coverModel" id="cm_v4_5_plus" value="V4_5PLUS"> 
                                <label for="cm_v4_5_plus">v4.5+</label>

                                <input type="radio" name="coverModel" id="cm_v5" value="V5" checked> 
                                <label for="cm_v5">v5</label>

                                <div class="glider"></div>
                            </div>
                        </div>

                        <div class="settings-grid">
                            <div class="form-group">
                                <label>Instrumental</label>
                                <div class="toggle-selector">
                                    <input type="radio" name="coverInstrumental" id="cover_inst_off" value="false" checked>
                                    <label for="cover_inst_off">Off</label>
                                    <input type="radio" name="coverInstrumental" id="cover_inst_on" value="true">
                                    <label for="cover_inst_on">On</label>
                                    <div class="glider"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Custom Mode</label>
                                <div class="toggle-selector">
                                    <input type="radio" name="coverCustomMode" id="cover_custom_off" value="false" checked>
                                    <label for="cover_custom_off">Off</label>
                                    <input type="radio" name="coverCustomMode" id="cover_custom_on" value="true">
                                    <label for="cover_custom_on">On</label>
                                    <div class="glider"></div>
                                </div>
                            </div>
                        </div>

                        <div id="coverCustomFields" class="hidden">
                            <div class="form-group input-wrapper">
                                <label>Title</label>
                                <input type="text" id="coverTitle" placeholder="New Song Title" maxlength="80">
                                <span id="coverTitleCounter" class="char-counter">0 / 80</span>
                            </div>
                            <div class="form-group input-wrapper">
                                <label>Style (Required)</label>
                                <input type="text" id="coverStyle" placeholder="Jazz, Classical...">
                                <span id="coverStyleCounter" class="char-counter">0 / 200</span>
                            </div>
                        </div>

                        <div class="form-group input-wrapper" id="coverPromptContainer">
                            <label id="coverPromptLabel">Song Description</label>
                            <textarea id="coverPrompt" placeholder="Describe the vibe..."></textarea>
                            <span id="coverPromptCounter" class="char-counter">0 / 3000</span>
                        </div>

                        <div class="advanced-section">
                            <div class="advanced-toggle" id="coverAdvancedToggle">
                                <span>Advanced Settings</span><i class="fa-solid fa-chevron-down"></i>
                            </div>
                            <div class="advanced-content" id="coverAdvancedContent">
                                <div class="form-group gender-group" id="coverVocalGenderGroup" style="margin-top: 15px;">
                                    <label>Vocal Gender</label>
                                    <div class="gender-options" id="covGenderOptions">
                                        <span class="gender-option" data-value="m">Male</span>
                                        <span class="gender-option" data-value="f">Female</span>
                                    </div>
                                    <input type="hidden" id="coverVocalGender" value="">
                                </div>
                                <div class="form-group">
                                    <label>Negative Tags</label>
                                    <input type="text" id="coverNegativeTags" placeholder="e.g. Drums">
                                </div>
                                <div class="sliders-grid">
                                    <div class="slider-control">
                                        <label>Style Weight</label>
                                        <input type="range" id="styleWeight" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                    <div class="slider-control">
                                        <label>Audio Weight</label>
                                        <input type="range" id="audioWeight" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                    <div class="slider-control">
                                        <label>Weirdness</label>
                                        <input type="range" id="weirdness" class="inactive-slider" min="0" max="1" step="0.01" value="0.65" data-touched="false">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="submit-row">
                            <button type="button" id="coverResetBtn" class="reset-btn"><i class="fa-solid fa-trash"></i></button>
                            <button type="submit" class="generate-btn"><i class="fa-solid fa-record-vinyl"></i> Create Cover</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- LOGS TAB -->
            <section id="logs" class="tab-content">
                <div class="glass-panel content-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h2>API Responses</h2>
                        <button class="clear-logs-btn" id="clearLogsBtn">Clear Logs</button>
                    </div>
                    <div class="logs-container" id="jsonOutput">
                        <div class="log-entry info">Waiting for requests...</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- LIBRARY / RIGHT SIDEBAR -->
        <aside class="glass-panel library-panel">
            <div class="library-header">
                <h3><i class="fa-solid fa-music"></i> Library</h3>
            </div>
            <div class="library-list" id="libraryGrid">
                <div class="empty-state">No music generated yet.</div>
            </div>
        </aside>
    </div>

    <!-- PLAYER BAR -->
    <div class="glass-panel player-bar">
        <div class="track-info">
            <img src="https://placehold.co/60" alt="" id="playerCover" class="player-cover">
            <div class="track-text">
                <h4 id="playerTitle">Select a track</h4>
                <div class="scrolling-text-container">
                    <p id="playerArtist">Suno AI</p>
                </div>
            </div>
        </div>
        <div class="player-center-group">
            <div class="player-controls">
                <button class="control-btn" id="shuffleBtn"><i class="fa-solid fa-shuffle"></i></button>
                <button class="control-btn" id="prevBtn"><i class="fa-solid fa-backward-step"></i></button>
                <button class="control-btn play-main" id="playPauseBtn"><i class="fa-solid fa-play"></i></button>
                <button class="control-btn" id="nextBtn"><i class="fa-solid fa-forward-step"></i></button>
                <button class="control-btn" id="loopBtn"><i class="fa-solid fa-repeat"></i></button>
            </div>
            <div class="player-progress-container">
                <span id="currentTime" class="time-text">0:00</span>
                <input type="range" id="progressBar" value="0" min="0" max="100">
                <span id="duration" class="time-text">0:00</span>
            </div>
        </div>
        <div class="player-right-spacer" style="width: 250px;"></div>
        <audio id="audioElement"></audio>
    </div>

    <!-- MODAL -->
    <div id="lyricsModal" class="modal hidden">
        <div class="glass-panel modal-content">
            <button class="close-modal-btn" id="closeModalBtn"><i class="fa-solid fa-xmark"></i></button>
            <div class="modal-body">
                <div class="modal-cover-container">
                    <img src="" id="modalCover" alt="Cover">
                    <div class="modal-track-details">
                        <h2 id="modalTitle">Track Title</h2>
                        <p id="modalTags">Tags</p>
                    </div>
                </div>
                <div class="lyrics-container">
                    <h3>Lyrics</h3>
                    <p id="modalLyrics">No lyrics available.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/player.js"></script>
    <script src="js/library.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/main.js"></script>
</body>
</html>